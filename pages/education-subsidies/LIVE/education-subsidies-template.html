<!--
====================================================================
ONE-TIME SETUP: Paste this template into Chabad One CMS
====================================================================
This template provides modern styling for the Education Subsidies page.
It automatically styles CMS-generated navigation buttons/links.
All styles are inline for maximum compatibility with Chabad One CMS.
====================================================================
-->

<div class="education-subsidies-wrapper">

<h1>Education Subsidies</h1>

<div class="intro-text">
  <p>Explore our education subsidy programs designed to support Jewish education in our community. Select a program below to learn more and apply.</p>
</div>

<!-- The CMS will inject navigation items here automatically -->
<!-- This template will style them as modern cards -->

</div>

<!-- Inline styles for immediate effect -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;600;700;800&display=swap');

/* Remove default background images and spacing - but preserve sidebar */
body,
body.cco_body {
    background-image: none !important;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 50%, #f0f7fb 100%) !important;
}

/* Base overflow and spacing fixes for main containers */
#BodyContainer,
#co_content_container,
.body_wrapper,
#content {
    background-image: none !important;
    background: transparent !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
}

/* Remove background images from CMS wrappers */
.master-content-wrapper,
.master-content-wrapper.g960,
div.master-content-wrapper,
div.master-content-wrapper.g960 {
    background-image: none !important;
    background: transparent !important;
    background-color: transparent !important;
    padding: 0 !important;
    margin: 0 !important;
    min-height: 0 !important;
}

/* Main wrapper */
.education-subsidies-wrapper {
    max-width: 1000px !important;
    margin: 0 auto !important;
    padding: 0.5rem 3rem 4rem 3rem !important;
    position: relative !important;
    z-index: 1 !important;
}

/* Main page title */
.education-subsidies-wrapper > h1 {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 4.5rem !important;
    font-weight: 800 !important;
    color: #000000 !important;
    text-align: center !important;
    margin: 0 0 1.5rem 0 !important;
    padding: 0 !important;
    position: relative !important;
    z-index: 2 !important;
    letter-spacing: -1px !important;
}

/* Intro text */
.intro-text {
    text-align: center !important;
    margin-bottom: 3rem !important;
}

.intro-text p {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 1.375rem !important;
    line-height: 1.7 !important;
    color: #555555 !important;
    max-width: 700px !important;
    margin: 0 auto !important;
}

/* ========================================
   CMS-GENERATED NAVIGATION STYLING
   These styles target the auto-generated navigation items
   ======================================== */

/* Target the article index container that CMS generates */
.article_index_container,
div.article_index_container {
    background: transparent !important;
    padding: 0 !important;
    margin: 2rem 0 !important;
}

/* Style the article index as a grid */
.article_index.co_index,
div.article_index.co_index {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)) !important;
    gap: 2rem !important;
    padding: 0 !important;
    margin: 0 !important;
    background: transparent !important;
}

/* Hide the original "font-size:0" styling */
#co_content_container > article > div.article_index_container > div.article_index.co_index.with_icons.clearfix > div > div > div > div.inner > div.title > a {
    font-size: inherit !important;
}

/* Each navigation item/card - Redesigned with split layout */
.article_index .item,
.article_index .row .item,
div.article_index div.item {
    background: #ffffff !important;
    border-radius: 24px !important;
    padding: 0 !important;
    margin: 0 !important;
    box-shadow:
        0 12px 40px rgba(0, 0, 0, 0.1),
        0 4px 12px rgba(0, 0, 0, 0.06) !important;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
    border: none !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: stretch !important;
    text-align: center !important;
    min-height: 320px !important;
    position: relative !important;
    overflow: hidden !important;
    cursor: pointer !important;
}

.article_index .item::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    height: 4px !important;
    background: linear-gradient(90deg, #000000 0%, #333333 100%) !important;
    transform: scaleX(0) !important;
    transform-origin: left !important;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

.article_index .item:hover::before {
    transform: scaleX(1) !important;
}

.article_index .item:hover {
    transform: translateY(-12px) scale(1.02) !important;
    box-shadow:
        0 24px 60px rgba(0, 0, 0, 0.15),
        0 8px 20px rgba(0, 0, 0, 0.1) !important;
}

/* Icon section - Fixed height container for predictable sizing */
.article_index .item div.synopsis_icon,
.article_index .item .synopsis_icon.float_left {
    float: none !important;
    width: 100% !important;
    height: 180px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin: 0 !important;
    background: linear-gradient(135deg, #f8f9fa 0%, #e8f4f8 50%, #dceef7 100%) !important;
    border-radius: 0 !important;
    padding: 2rem !important;
    box-shadow: none !important;
    position: relative !important;
}

.article_index .item div.synopsis_icon::after {
    content: '' !important;
    position: absolute !important;
    bottom: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 60px !important;
    height: 3px !important;
    background: linear-gradient(90deg, transparent, #000000, transparent) !important;
    opacity: 0.2 !important;
}

/* Style the icon link - fills container */
.article_index .item a.synopsis_icon,
a.synopsis_icon.small_right_margin {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
    height: 100% !important;
    margin: 0 !important;
    background: transparent !important;
    text-decoration: none !important;
}

/* Style the actual CMS icon images - Fill container proportionally */
.article_index .item img.synopsis_icon,
img.synopsis_icon {
    width: auto !important;
    height: 100% !important;
    max-width: 100% !important;
    max-height: 140px !important;
    object-fit: contain !important;
    margin: 0 !important;
    border-radius: 0 !important;
    filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15)) !important;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    transform: scale(1) !important;
}

.article_index .item:hover img.synopsis_icon {
    transform: scale(1.08) !important;
}

/* Content section wrapper */
.article_index .item .inner,
div.article_index div.inner {
    width: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    padding: 2rem 2rem 2.5rem 2rem !important;
    background: #ffffff !important;
}

/* Title styling - Bold and prominent */
.article_index .item .title,
.article_index .item div.title {
    margin: 0 0 1rem 0 !important;
    padding: 0 !important;
    width: 100% !important;
    position: relative !important;
    z-index: 1 !important;
}

.article_index .item .title a,
.article_index .item div.title a {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 1.875rem !important;
    font-weight: 800 !important;
    color: #000000 !important;
    text-decoration: none !important;
    display: block !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    letter-spacing: -0.5px !important;
    background: transparent !important;
}

/* Make the entire card clickable by stretching the link */
.article_index .item .title a::after {
    content: '' !important;
    position: absolute !important;
    top: calc(-180px - 2rem) !important; /* Cover icon section (180px) + inner top padding (2rem) */
    left: -2rem !important; /* Cover inner left padding */
    right: -2rem !important; /* Cover inner right padding */
    bottom: -10rem !important; /* Cover synopsis text + bottom padding */
    z-index: 1 !important;
}

.article_index .item:hover .title a {
    color: #d4af37 !important;
    transform: scale(1.05) !important;
}

/* Synopsis/description text - Subtle and clean */
.article_index .item .synopsis,
.article_index .item div.synopsis {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 1rem !important;
    line-height: 1.7 !important;
    color: #666666 !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
}

/* Subtitle if present */
.article_index .item .subtitle,
.article_index .item div.subtitle {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 0.875rem !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    color: #999999 !important;
    margin: 0 0 0.5rem 0 !important;
}

/* Remove any row/column layouts from CMS */
.article_index .row,
div.article_index div.row {
    display: contents !important;
}

.article_index .col,
.article_index .column,
div.article_index div.col,
div.article_index div.column {
    display: contents !important;
}

/* Item contents wrapper */
.article_index .item .item_contents,
.article_index .item div.item_contents {
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
}

/* ========================================
   MODERN GLASSMORPHISM SIDEBAR - DESKTOP
   ======================================== */
.g260,
div.g260,
.cco_search_header,
div[class*="g260"] {
    position: fixed !important;
    right: 0 !important;
    top: 50% !important;
    transform: translateY(-50%) translateX(calc(100% - 60px)) !important;

    /* Glassmorphism effect */
    background: rgba(255, 255, 255, 0.85) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;

    /* Premium borders and shadows */
    border-radius: 24px 0 0 24px !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important;
    border-right: none !important;
    box-shadow:
        -8px 0 32px rgba(0, 0, 0, 0.12),
        -2px 0 8px rgba(0, 0, 0, 0.06),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5) !important;

    /* Sizing and spacing */
    padding: 2rem 1.5rem 2rem 2rem !important;
    margin: 0 !important;
    width: 320px !important;
    max-height: 85vh !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;

    /* Spring animation */
    transition: all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) !important;

    /* Layer */
    z-index: 1000 !important;
}

/* Hover to expand with smooth spring effect */
.g260:hover,
div.g260:hover,
.cco_search_header:hover {
    transform: translateY(-50%) translateX(0) !important;
    background: rgba(255, 255, 255, 0.95) !important;
    box-shadow:
        -12px 0 48px rgba(0, 0, 0, 0.18),
        -4px 0 12px rgba(0, 0, 0, 0.08),
        inset 0 0 0 1px rgba(255, 255, 255, 0.6) !important;
}

/* Tab indicator - modern minimal design */
.g260::before,
div.g260::before,
.cco_search_header::before {
    content: '' !important;
    position: absolute !important;
    left: 16px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    width: 24px !important;
    height: 4px !important;
    background: linear-gradient(90deg,
        rgba(30, 58, 138, 0.6),
        rgba(59, 130, 246, 0.8)) !important;
    border-radius: 2px !important;
    box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3) !important;
    transition: all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    pointer-events: none !important;
}

/* Indicator rotates and changes on hover */
.g260:hover::before,
div.g260:hover::before,
.cco_search_header:hover::before {
    transform: translateY(-50%) rotate(90deg) !important;
    width: 4px !important;
    height: 24px !important;
    background: linear-gradient(180deg,
        rgba(30, 58, 138, 0.8),
        rgba(59, 130, 246, 1)) !important;
}

/* Custom scrollbar for sidebar */
.g260::-webkit-scrollbar,
div.g260::-webkit-scrollbar,
.cco_search_header::-webkit-scrollbar {
    width: 6px !important;
}

.g260::-webkit-scrollbar-track,
div.g260::-webkit-scrollbar-track,
.cco_search_header::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05) !important;
    border-radius: 3px !important;
}

.g260::-webkit-scrollbar-thumb,
div.g260::-webkit-scrollbar-thumb,
.cco_search_header::-webkit-scrollbar-thumb {
    background: rgba(30, 58, 138, 0.3) !important;
    border-radius: 3px !important;
}

.g260::-webkit-scrollbar-thumb:hover,
div.g260::-webkit-scrollbar-thumb:hover,
.cco_search_header::-webkit-scrollbar-thumb:hover {
    background: rgba(30, 58, 138, 0.5) !important;
}

/* Search form styling */
.co_search_form {
    margin: 0 !important;
    padding: 0 !important;
}

.co_search_form form {
    display: flex !important;
    align-items: center !important;
    gap: 0.5rem !important;
}

.co_global_input_container input[type="text"],
.co_global_input_container input {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 0.95rem !important;
    padding: 0.75rem 1rem !important;
    border: 2px solid rgba(0, 0, 0, 0.1) !important;
    border-radius: 10px !important;
    background: #fafbfc !important;
    transition: all 0.3s ease !important;
    width: 100% !important;
}

.co_global_input_container input:focus {
    outline: none !important;
    border-color: #000000 !important;
    background: #ffffff !important;
}

.co_global_submit button,
.co_global_submit .button {
    background: #000000 !important;
    border: none !important;
    border-radius: 10px !important;
    padding: 0.75rem 1.25rem !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    font-family: 'Urbanist', sans-serif !important;
    font-weight: 600 !important;
    color: #ffffff !important;
}

.co_global_submit button:hover {
    background: #333333 !important;
    transform: translateY(-2px) !important;
}

/* Sidebar navigation links */
#sidebar-local-navigation,
.sidebar-local-navigation,
aside[class*="sidebar"],
.co_local_menu {
    padding: 0 !important;
    margin: 0 !important;
}

.co_local_menu ul,
.sidebar-local-navigation ul {
    list-style: none !important;
    padding: 0 !important;
    margin: 0 !important;
}

.co_local_menu li,
.sidebar-local-navigation li {
    margin-bottom: 0.5rem !important;
}

.co_local_menu a,
.sidebar-local-navigation a {
    font-family: 'Urbanist', sans-serif !important;
    font-size: 1rem !important;
    font-weight: 500 !important;
    color: #333333 !important;
    text-decoration: none !important;
    padding: 0.75rem 1rem !important;
    display: block !important;
    border-radius: 10px !important;
    background: #fafbfc !important;
    border: 1px solid rgba(0, 0, 0, 0.06) !important;
    transition: all 0.3s ease !important;
}

.co_local_menu a:hover,
.sidebar-local-navigation a:hover {
    background: #000000 !important;
    color: #ffffff !important;
    transform: translateX(4px) !important;
}

/* Mobile responsive */
@media (max-width: 768px) {
    #BodyContainer,
    #co_content_container,
    .body_wrapper {
        padding: 0 !important;
        margin: 0 !important;
    }

    .education-subsidies-wrapper {
        padding: 0.25rem 1rem 2rem 1rem !important;
    }

    .education-subsidies-wrapper > h1 {
        font-size: 2.5rem !important;
        margin: 0 0 1rem 0 !important;
    }

    .intro-text p {
        font-size: 1.125rem !important;
    }

    .article_index.co_index,
    div.article_index.co_index {
        grid-template-columns: 1fr !important;
        gap: 1.5rem !important;
    }

    .article_index .item,
    .article_index .row .item,
    div.article_index div.item {
        min-height: 280px !important;
        border-radius: 20px !important;
    }

    .article_index .item div.synopsis_icon,
    .article_index .item .synopsis_icon.float_left {
        height: 160px !important;
        padding: 1.5rem !important;
    }

    .article_index .item img.synopsis_icon,
    img.synopsis_icon {
        max-height: 120px !important;
    }

    .article_index .item:hover img.synopsis_icon {
        transform: scale(1.08) !important;
    }

    .article_index .item .inner {
        padding: 1.5rem 1.5rem 2rem 1.5rem !important;
    }

    .article_index .item .title a,
    .article_index .item div.title a {
        font-size: 1.625rem !important;
    }

    .article_index .item .synopsis,
    .article_index .item div.synopsis {
        font-size: 0.95rem !important;
    }

    /* ========================================
       MOBILE BOTTOM SHEET SIDEBAR
       ======================================== */
    /* Hide original sidebar on mobile - we create a custom one via JavaScript */
    .g260,
    div.g260,
    .cco_search_header {
        display: none !important;
    }

    .co_local_menu a,
    .sidebar-local-navigation a {
        font-size: 0.95rem !important;
        padding: 0.65rem 0.85rem !important;
    }
}

/* Responsive adjustments for smaller phones */
@media (max-width: 480px) {
    .hero-title {
        font-size: 2rem !important;
    }

    .hero-subtitle {
        font-size: 1rem !important;
    }
}

/* Responsive adjustments for larger phones and tablets */
@media (min-width: 481px) and (max-width: 768px) {
    .hero-title {
        font-size: 2.5rem !important;
    }
}
</style>

<script>
//<![CDATA[
(function() {
    // Only run on mobile
    if (window.innerWidth > 768) {
        return;
    }

    var initialized = false;
    var backdrop = null;
    var isOpen = false;

    function findSidebar() {
        // Try all possible selectors
        var selectors = [
            '.g260',
            'div.g260',
            '.cco_search_header',
            '[class*="g260"]',
            'aside',
            '[class*="sidebar"]',
            '[class*="search"]'
        ];

        for (var i = 0; i < selectors.length; i++) {
            var el = document.querySelector(selectors[i]);
            if (el) {
                // Check if it looks like a sidebar (positioned fixed or absolute)
                var style = window.getComputedStyle(el);
                if (style.position === 'fixed' || style.position === 'absolute') {
                    return el;
                }
            }
        }
        return null;
    }

    function initMobileSidebar() {
        if (initialized) return;

        var originalSidebar = findSidebar();
        if (!originalSidebar) {
            console.log('Sidebar not found yet...');
            return;
        }

        // Check if sidebar has REAL content (navigation links, not just search form)
        // The search form loads first (87 chars), navigation links load later
        var sidebarContent = originalSidebar.textContent || originalSidebar.innerText || '';
        var contentLength = sidebarContent.trim().length;

        // Look for navigation elements specifically
        var hasNavigation = originalSidebar.querySelector('.co_local_menu, .sidebar-local-navigation, nav, ul li a') !== null;
        var hasMultipleChildren = originalSidebar.children.length > 1;
        var hasSubstantialContent = contentLength > 200; // Navigation links will make it much longer than 87 chars

        if (!hasNavigation && !hasMultipleChildren && !hasSubstantialContent) {
            console.log('Sidebar found but only has search form (', contentLength, 'chars), waiting for navigation...');
            return;
        }

        initialized = true;
        console.log('Mobile sidebar initialized!', originalSidebar);
        console.log('Sidebar has', originalSidebar.children.length, 'child elements');
        console.log('Sidebar content length:', sidebarContent.length);

        // HIDE the original sidebar completely on mobile - we'll create our own
        originalSidebar.style.setProperty('display', 'none', 'important');

        // Calculate responsive height based on screen size
        var viewportHeight = window.innerHeight;
        var sidebarHeight = viewportHeight <= 667 ? '85vh' : '80vh'; // iPhone SE and smaller get more height
        var visibleTab = viewportHeight <= 667 ? '50px' : '60px'; // Smaller tab on small screens

        // Create a BRAND NEW mobile sidebar container with full control
        var mobileSidebar = document.createElement('div');
        mobileSidebar.className = 'mobile-sidebar-custom';
        mobileSidebar.style.cssText = `
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            width: 100% !important;
            height: ${sidebarHeight} !important;
            max-height: ${sidebarHeight} !important;
            background: rgba(255, 255, 255, 0.98) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border-radius: 28px 28px 0 0 !important;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.2) !important;
            transform: translateY(calc(100% - ${visibleTab})) !important;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            z-index: 100001 !important;
            overflow-y: auto !important;
            padding: 20px !important;
            padding-top: 60px !important;
        `.replace(/\s+/g, ' ').trim();

        // Add iOS-style handle pill
        var handle = document.createElement('div');
        handle.style.cssText = `
            position: absolute !important;
            top: 16px !important;
            left: 50% !important;
            transform: translateX(-50%) !important;
            width: 48px !important;
            height: 5px !important;
            background: rgba(30, 58, 138, 0.3) !important;
            border-radius: 3px !important;
            pointer-events: none !important;
        `.replace(/\s+/g, ' ').trim();
        mobileSidebar.appendChild(handle);

        // Clone the content from original sidebar
        var contentWrapper = document.createElement('div');
        contentWrapper.className = 'mobile-sidebar-content';
        contentWrapper.style.cssText = `
            width: 100% !important;
            overflow-x: hidden !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        `.replace(/\s+/g, ' ').trim();

        // Deep clone to preserve all elements and event listeners
        var clonedContent = originalSidebar.cloneNode(true);

        // Remove the display:none we added
        clonedContent.style.display = 'block';
        clonedContent.style.visibility = 'visible';
        clonedContent.style.opacity = '1';

        // Transfer all content
        while (clonedContent.firstChild) {
            contentWrapper.appendChild(clonedContent.firstChild);
        }

        // Force all child elements to be visible
        var allElements = contentWrapper.getElementsByTagName('*');
        for (var i = 0; i < allElements.length; i++) {
            var el = allElements[i];
            // Don't force scripts or hidden inputs to be visible
            if (el.tagName !== 'SCRIPT' && el.tagName !== 'STYLE' && el.type !== 'hidden') {
                el.style.display = el.style.display === 'none' ? 'block' : el.style.display;
                el.style.visibility = 'visible';
                el.style.opacity = el.style.opacity === '0' ? '1' : el.style.opacity;
            }
        }

        mobileSidebar.appendChild(contentWrapper);

        console.log('Sidebar content cloned. Content HTML:', contentWrapper.innerHTML.substring(0, 500));
        console.log('Content has children:', contentWrapper.children.length);

        document.body.appendChild(mobileSidebar);

        // Create backdrop
        backdrop = document.createElement('div');
        backdrop.style.cssText = `
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: rgba(0,0,0,0.5) !important;
            opacity: 0 !important;
            visibility: hidden !important;
            z-index: 100000 !important;
            transition: all 0.3s ease !important;
            pointer-events: none !important;
        `.replace(/\s+/g, ' ').trim();
        document.body.appendChild(backdrop);

        var touchStartY = 0;
        var touchStartTime = 0;

        function open() {
            isOpen = true;
            mobileSidebar.style.transform = 'translateY(0) !important';
            mobileSidebar.style.setProperty('transform', 'translateY(0)', 'important');

            if (backdrop) {
                backdrop.style.opacity = '1';
                backdrop.style.visibility = 'visible';
                backdrop.style.pointerEvents = 'auto';
            }

            console.log('Mobile sidebar opened!');
        }

        function close() {
            isOpen = false;
            mobileSidebar.style.setProperty('transform', 'translateY(calc(100% - ' + visibleTab + '))', 'important');

            if (backdrop) {
                backdrop.style.opacity = '0';
                backdrop.style.visibility = 'hidden';
                backdrop.style.pointerEvents = 'none';
            }

            console.log('Mobile sidebar closed');
        }

        // Touch handling for opening the sidebar
        function handleSidebarTouch(e) {
            // Only handle touches on the visible tab area (bottom 60px) when closed
            if (!isOpen) {
                var rect = mobileSidebar.getBoundingClientRect();
                var touchY = e.touches[0].clientY;
                // Check if touch is in the visible tab area
                if (touchY >= rect.top && touchY <= window.innerHeight) {
                    touchStartY = touchY;
                    touchStartTime = Date.now();
                }
            }
        }

        function handleSidebarTouchEnd(e) {
            if (!isOpen) {
                var touchEndY = e.changedTouches[0].clientY;
                var touchEndTime = Date.now();
                var verticalDiff = Math.abs(touchEndY - touchStartY);
                var timeDiff = touchEndTime - touchStartTime;

                // Tap to open (minimal movement, quick duration)
                if (verticalDiff < 20 && timeDiff < 400) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Sidebar tab tapped!');
                    open();
                    return false;
                }
                // Swipe up to open
                else if (touchEndY < touchStartY - 30 && timeDiff < 500) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Swipe up detected!');
                    open();
                    return false;
                }
            }
        }

        // Attach events to mobileSidebar
        mobileSidebar.addEventListener('touchstart', handleSidebarTouch, { passive: true });
        mobileSidebar.addEventListener('touchend', handleSidebarTouchEnd, false);

        // Also handle clicks for desktop testing
        mobileSidebar.addEventListener('click', function(e) {
            if (!isOpen) {
                var rect = mobileSidebar.getBoundingClientRect();
                var clickY = e.clientY;
                // Only open if clicking in visible tab area
                if (clickY >= rect.top) {
                    e.preventDefault();
                    console.log('Sidebar tab clicked!');
                    open();
                }
            }
        }, false);

        // Backdrop events to close
        if (backdrop) {
            backdrop.addEventListener('touchend', function(e) {
                e.preventDefault();
                e.stopPropagation();
                close();
            }, false);

            backdrop.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                close();
            }, false);
        }

        // Keyboard
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isOpen) {
                close();
            }
        });

        console.log('Mobile sidebar events attached');
    }

    // Use MutationObserver to watch for sidebar being added
    var observer = new MutationObserver(function(mutations) {
        if (!initialized) {
            initMobileSidebar();
        }
    });

    observer.observe(document.documentElement, {
        childList: true,
        subtree: true
    });

    // Also try the traditional methods
    initMobileSidebar();

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMobileSidebar);
    }

    window.addEventListener('load', initMobileSidebar);

    // Try initialization multiple times with increasing delays
    // The CMS loads search form first (~87 chars), then navigation links dynamically
    // We need to wait for the full navigation content to load
    setTimeout(initMobileSidebar, 100);
    setTimeout(initMobileSidebar, 300);
    setTimeout(initMobileSidebar, 500);
    setTimeout(initMobileSidebar, 800);
    setTimeout(initMobileSidebar, 1000);
    setTimeout(initMobileSidebar, 1500);
    setTimeout(initMobileSidebar, 2000);
    setTimeout(initMobileSidebar, 2500);
    setTimeout(initMobileSidebar, 3000);
    setTimeout(initMobileSidebar, 4000);
    setTimeout(initMobileSidebar, 5000);
    setTimeout(initMobileSidebar, 6000);
    setTimeout(initMobileSidebar, 7000);
    setTimeout(initMobileSidebar, 8000);
    setTimeout(initMobileSidebar, 10000);
})();
//]]>
</script>
